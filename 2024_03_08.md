# Metallb Loadbalancer


## Setup

Helm Deployment
```
# Create Namespace
kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.8/manifests/namespace.yaml

helm repo add metallb https://metallb.github.io/metallb
helm install metallb metallb/metallb -n metallb-system
```

Check
```
kubectl -n metallb-system get po
```


## Set the IPAddressPool


vi IPAddressPool.yml
```
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: sandbox
  namespace: metallb-system
spec:
  addresses:
  - 172.16.0.200-172.16.0.210
```
kubectl apply -f IPAddressPool.yml


Check
```
kubectl -n metallb-system get IPAddressPool
```

Info: The Ip range have to be reserved. You can get the range from
```
k get no -o wide
```




## Create sample deployment

```
kubectl create deploy nginx-metallb --image nginx:stable-alpine
kubectl expose deploy nginx-metallb --port 80 --type=LoadBalancer
kubectl get svc

kubectl create deploy nginx-metallb2 --image nginx:stable-alpine
kubectl expose deploy nginx-metallb2 --port 80 --type=LoadBalancer
kubectl get svc

```


## Othe useful commands

```
calicoctl get ippool
calicoctl get bgpconfig
calicoctl get bgppeer
run show ip route

```


# Ingress


## Install the Ingress Controller
```
kubectl apply -f https://raw.githubusercontent.com/nginxinc/kubernetes-ingress/v3.4.3/deploy/crds.yaml

helm install nginx oci://ghcr.io/nginxinc/charts/nginx-ingress --version 1.1.3
```







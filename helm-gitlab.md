# Gitlab


Helm Deployment von Gitlab
```
helm repo add gitlab https://charts.gitlab.io/
helm repo update

helm upgrade --install gitlab gitlab/gitlab --namespace gitlab \
            --set global.edition=ce \
            --set certmanager-issuer.email=youremail@domain.com \
            --set global.hosts.domain=yourdomain.com

helm upgrade --install gitlab gitlab/gitlab --namespace gitlab \
            --set global.edition=ce

Get the external address of your GitLab service
echo http://$(kubectl get svc --namespace gitlab \
            gitlab-nginx-ingress-controller \
            -o jsonpath='{.status.loadBalancer.ingress[0].hostname}')


Get the default root password
kubectl get secret gitlab-gitlab-initial-root-password -ojsonpath='{.data.password}' | base64 --decode ; echo

Set a new password and sign in using the root user and your new password            
```



Upgrage
```
# First, export the currently used arguments into a YAML file
helm get values gitlab > gitlab.yaml

helm repo update

# List the available chart versions
helm search -l gitlab/gitlab

helm upgrade gitlab gitlab/gitlab --version 2.1.7 -f gitlab.yaml
```


Using your own wildcard certificate
```
# Add your certificate and key to the cluster as a secret
kubectl create secret tls mytls --cert=cert.crt --key=key.key


# Deploy GitLab from the Helm chart using the following additional parameters
helm upgrade --install gitlab gitlab/gitlab --namespace gitlab \
            --timeout 600 \
            --set global.edition=ce \
            --version 2.1.6 \
            --set certmanager.install=false \
            --set global.ingress.configureCertmanager=false \
            --set global.ingress.tls.secretName=mytls


```


Using autogenerated self-signed certificates
```
# If you can't effo using your own wildcard certificate and still want to get GitLab quickly up for testing or smaller use cases, you can also use autogenerated self-signed certificates. In this recipe, we will explain using self-signed certificates, which can be useful in environments where Let's Encrypt is not an option, but SSL security is still needed

helm upgrade --install gitlab gitlab/gitlab --namespace gitlab \
            --timeout 600 \
            --set global.edition=ce \
            --version 2.1.6 \
            --set certmanager.install=false \
            --set global.ingress.configureCertmanager=false \
            --set gitlab-runner.install=false

# Retrieve the certificate, which can be imported into a web browser or system store later
kubectl get secret gitlab-wildcard-tls-ca -n gitlab \
            -ojsonpath='{.data.cfssl_ca}' | base64 --decode >
            gitlab.mydomain.com.ca.pem

```
